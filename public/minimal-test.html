<!DOCTYPE html>
<html>
<head>
    <title>Minimal CCAvenue Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        button { background: #4caf50; color: white; padding: 15px 30px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 10px 0; }
        .warning { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 4px; margin: 10px 0; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Minimal CCAvenue Test</h1>
        
        <div class="warning">
            <h3>‚ö†Ô∏è Account Configuration Test</h3>
            <p>This test uses the absolute minimum required parameters to check if your CCAvenue account recognizes your credentials.</p>
            <p>If this still shows 10001 error, it's definitely an account configuration issue.</p>
        </div>

        <button onclick="createMinimalTest()">üöÄ Create Minimal Payment Test</button>
        
        <div id="test-results"></div>
        <div id="payment-form"></div>
        
        <div id="logs">
            <h3>üìã Test Logs:</h3>
            <pre id="log-output">Click the button to start minimal test...</pre>
        </div>
    </div>

    <script>
        let logs = [];
        
        function addLog(message) {
            const timestamp = new Date().toISOString();
            logs.push(`[${timestamp}] ${message}`);
            document.getElementById('log-output').textContent = logs.join('\n');
        }
        
        async function createMinimalTest() {
            const resultsDiv = document.getElementById('test-results');
            const formDiv = document.getElementById('payment-form');
            
            addLog('Creating minimal payment test...');
            resultsDiv.innerHTML = '<p>Creating minimal payment test...</p>';
            
            try {
                // Use absolute minimal required parameters
                const minimalData = {
                    orderId: 'MIN_' + Date.now(),
                    amount: '1.00',
                    billingName: 'Test',
                    billingEmail: 'test@test.com',
                    billingTel: '9999999999',
                    billingAddress: 'Test',
                    isIndia: true
                };
                
                addLog(`Minimal payment data: ${JSON.stringify(minimalData, null, 2)}`);
                
                const response = await fetch('/api/ccavenue/create-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(minimalData)
                });
                
                addLog(`API Response status: ${response.status}`);
                
                const data = await response.json();
                addLog(`API Response: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success && data.encRequest) {
                    resultsDiv.innerHTML = `
                        <div style="background: #e8f5e8; border: 1px solid #4caf50; padding: 15px; border-radius: 4px; color: #2e7d32;">
                            ‚úÖ Minimal payment request created!<br>
                            <strong>This confirms your API is working.</strong><br>
                            Encrypted Length: ${data.encRequest.length}<br>
                            Merchant: ${data.merchantId}
                        </div>
                    `;
                    
                    // Create the form
                    const form = document.createElement('form');
                    form.method = 'post';
                    form.action = 'https://secure.ccavenue.com/transaction/transaction.do?command=initiateTransaction';
                    form.target = '_blank';
                    
                    const encRequestInput = document.createElement('input');
                    encRequestInput.type = 'hidden';
                    encRequestInput.name = 'encRequest';
                    encRequestInput.value = data.encRequest;
                    
                    const accessCodeInput = document.createElement('input');
                    accessCodeInput.type = 'hidden';
                    accessCodeInput.name = 'access_code';
                    accessCodeInput.value = data.accessCode;
                    
                    form.appendChild(encRequestInput);
                    form.appendChild(accessCodeInput);
                    
                    formDiv.innerHTML = `
                        <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 4px; margin-top: 20px;">
                            <h3>üéØ Critical Test</h3>
                            <p><strong>IMPORTANT:</strong> This is the final test. If this shows 10001 error, the issue is with your CCAvenue account configuration, NOT your code.</p>
                            <button onclick="document.getElementById('minimal-form').submit()" style="background: #ff9800; padding: 20px 40px; font-size: 18px; border: none; border-radius: 4px; color: white; cursor: pointer;">
                                üöÄ Submit Minimal Test to CCAvenue
                            </button>
                        </div>
                    `;
                    
                    form.id = 'minimal-form';
                    form.style.display = 'none';
                    document.body.appendChild(form);
                    
                    addLog('Minimal form created and ready for submission');
                    addLog('If this test shows 10001 error, contact CCAvenue support immediately');
                    
                } else {
                    resultsDiv.innerHTML = `
                        <div style="background: #ffebee; border: 1px solid #f44336; padding: 15px; border-radius: 4px; color: #c62828;">
                            ‚ùå Error: ${data.error}
                        </div>
                    `;
                    addLog(`Error in minimal payment creation: ${data.error}`);
                }
                
            } catch (error) {
                addLog(`Network error: ${error.message}`);
                resultsDiv.innerHTML = `
                    <div style="background: #ffebee; border: 1px solid #f44336; padding: 15px; border-radius: 4px; color: #c62828;">
                        ‚ùå Network Error: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
